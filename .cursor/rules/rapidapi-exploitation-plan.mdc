# ğŸ“¡ RapidAPI Exploitation Plan - Yahoo Finance 15

**Created:** 2025-12-19
**API:** Yahoo Finance 15 (RapidAPI)
**Status:** TESTED & VALIDATED âœ…

---

## ğŸ¯ MISSION

Exploit the Yahoo Finance 15 RapidAPI to enhance our:
1. **News Intelligence** - Real-time market narrative extraction
2. **Price Data** - Live quotes and historical data
3. **Technical Indicators** - SMA, RSI, MACD, ADX
4. **Narrative Brain** - Contextual market storytelling

---

## ğŸ”‘ API CREDENTIALS

```python
RAPIDAPI_KEY = "9f107deaabmsh2efbc3559ddca05p17f1abjsn271e6df32f7c"
RAPIDAPI_HOST = "yahoo-finance15.p.rapidapi.com"
BASE_URL = "https://yahoo-finance15.p.rapidapi.com/api"
```

**Store in `.env`:**
```bash
YAHOO_RAPIDAPI_KEY=9f107deaabmsh2efbc3559ddca05p17f1abjsn271e6df32f7c
YAHOO_RAPIDAPI_HOST=yahoo-finance15.p.rapidapi.com
```

---

## âœ… VALIDATED ENDPOINTS

### 1. ğŸ“° News Intelligence - `/v2/markets/news`

**Status:** âœ… WORKING - GOLD MINE

**Request:**
```bash
GET /api/v2/markets/news?ticker=SPY&type=ALL
```

**Response (50 articles):**
```json
{
  "meta": {"status": 200, "total": 50},
  "body": [
    {
      "url": "https://seekingalpha.com/article/...",
      "img": "https://cdn.snapi.dev/images/...",
      "title": "S&P 500: Butterfly Effect From Japan Rate Hike",
      "text": "Japan's anticipated rate hike marks a historic shift...",
      "source": "Seeking Alpha",
      "type": "Article",
      "tickers": ["#IVV", "#SPXL", "#SSO", "#UPRO", "#VOO"],
      "time": "Dec 18, 2025, 5:22 PM EST",
      "ago": "2 hours ago"
    }
  ]
}
```

**Exploitation Strategy:**
1. Fetch news for SPY, QQQ every 15 minutes
2. Filter by recency ("1 hour ago", "2 hours ago")
3. Extract key themes using LLM (Diffbot or local)
4. Detect sentiment divergence (bullish/bearish headlines)
5. Feed context to Narrative Brain

**Key Data Points:**
- `title` - Headline for quick scan
- `text` - Summary for context
- `source` - Weight by credibility (Seeking Alpha > random blog)
- `tickers` - Cross-reference with our universe
- `ago` - Filter for freshness

---

### 2. ğŸ“Š Real-Time Quotes - `/v1/markets/stock/quotes`

**Status:** âœ… WORKING - COMPREHENSIVE

**Request:**
```bash
GET /api/v1/markets/stock/quotes?ticker=SPY,QQQ
```

**Response (Key Fields):**
```json
{
  "symbol": "SPY",
  "regularMarketPrice": 676.47,
  "regularMarketChange": 5.07,
  "regularMarketChangePercent": 0.755,
  "regularMarketVolume": 107490904,
  "regularMarketDayHigh": 680.72,
  "regularMarketDayLow": 674.9,
  "regularMarketOpen": 677.6,
  "regularMarketPreviousClose": 671.4,
  "fiftyDayAverage": 674.83,
  "twoHundredDayAverage": 621.51,
  "fiftyTwoWeekHigh": 689.7,
  "fiftyTwoWeekLow": 481.8,
  "trailingPE": 27.28,
  "dividendYield": 1.06,
  "ytdReturn": 17.69,
  "marketState": "POSTPOST",
  "postMarketPrice": 676.445,
  "postMarketChange": -0.025
}
```

**Exploitation Strategy:**
1. Use for real-time price confirmation
2. Calculate gap from previous close (pre-market gap signals)
3. Compare to 50/200 day averages
4. Track post-market moves

---

### 3. ğŸ“ˆ Historical Data - `/v1/markets/stock/history`

**Status:** âœ… WORKING

**Request:**
```bash
GET /api/v1/markets/stock/history?ticker=SPY&period=1d&interval=1m
```

**Response:**
- Minute-by-minute OHLCV data
- Use for intraday pattern detection
- Feed to signal generators

---

### 4. ğŸ“ Technical Indicators - `/v1/indicators/*`

**Endpoints:**
```
/v1/indicators/sma?ticker=SPY&period=20
/v1/indicators/rsi?ticker=SPY&period=14
/v1/indicators/macd?ticker=SPY
/v1/indicators/adx?ticker=SPY&period=14
```

**Status:** â³ TO BE TESTED

---

## âœ… OPTIONS ENDPOINTS - GOLD MINE!

### 1. ğŸ“Š Most Active Options - `/v1/markets/options/most-active`

**Status:** âœ… **WORKING - INCREDIBLE DATA!**

**Request:**
```bash
GET /api/v1/markets/options/most-active?type=STOCKS
```

**Response (Top 20 by Volume):**
```json
{
  "meta": {"status": 200, "total": 500},
  "body": [
    {
      "symbol": "TSLA",
      "symbolName": "Tesla Inc",
      "lastPrice": "483.37",
      "priceChange": "+16.11",
      "percentChange": "+3.45%",
      "optionsTotalVolume": "2,956,982",
      "optionsPutVolumePercent": "40.0%",
      "optionsCallVolumePercent": "60.0%",
      "optionsPutCallVolumeRatio": "0.67",
      "optionsImpliedVolatilityRank1y": "8.02%"
    }
  ]
}
```

**Key Signals:**
- **P/C Ratio < 0.7**: BULLISH call accumulation (TSLA, RIVN, AMZN)
- **P/C Ratio > 1.0**: BEARISH put accumulation (MSTR, NFLX, ORCL)
- **Volume Spike + Direction**: Institutional flow indication

---

### 2. ğŸ”¥ Unusual Options Activity - `/v1/markets/options/unusual-options-activity`

**Status:** âœ… **WORKING - 1,859 UNUSUAL OPTIONS!**

**Request:**
```bash
GET /api/v1/markets/options/unusual-options-activity?type=STOCKS
```

**Response:**
```json
{
  "meta": {"status": 200, "total": 1859},
  "body": [
    {
      "symbol": "SEI|20260116|40.00P",
      "baseSymbol": "SEI",
      "baseLastPrice": "43.06",
      "symbolType": "Put",
      "strikePrice": "40.00",
      "expirationDate": "01/16/26",
      "daysToExpiration": "29",
      "volume": "12,147",
      "openInterest": "151",
      "volumeOpenInterestRatio": "80.44",
      "volatility": "92.86%",
      "delta": "-0.3374"
    }
  ]
}
```

**Exploitation Strategy:**
- **Vol/OI Ratio > 30**: Unusual activity (potential insider knowledge)
- **Near-dated + High Vol/OI**: Catalyst expected
- **Far OTM + High Vol/OI**: Lottery ticket/hedge

---

### 3. ğŸ“ˆ Options Chain - `/v1/markets/options`

**Status:** âœ… **WORKING**

**Request:**
```bash
GET /api/v1/markets/options?ticker=SPY&display=straddle
```

**Response:**
- Full options chain with straddle display
- All expirations and strikes
- Bid/Ask, Greeks, Volume, OI

---

## âŒ NON-WORKING ENDPOINTS

| Endpoint | Status | Alternative |
|----------|--------|-------------|
| `/v1/stock/modules` | âŒ Redirect | N/A |

---

## ğŸ§  NARRATIVE BRAIN INTEGRATION

### News â†’ Narrative Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RapidAPI News  â”‚â”€â”€â”€â”€â–¶â”‚   LLM Summarizer â”‚â”€â”€â”€â”€â–¶â”‚ Narrative Brain â”‚
â”‚  (50 articles)  â”‚     â”‚   (Filter top 5) â”‚     â”‚ (Context Store) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚  Discord Alert  â”‚
                                                 â”‚ (Context-Aware) â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation Plan

**Phase 1: News Fetcher (2 hours)**
```python
# core/data/rapidapi_news_client.py

class RapidAPINewsClient:
    def __init__(self):
        self.api_key = os.getenv('YAHOO_RAPIDAPI_KEY')
        self.host = os.getenv('YAHOO_RAPIDAPI_HOST')
        
    def fetch_news(self, ticker: str, limit: int = 50) -> List[NewsArticle]:
        """Fetch latest news for ticker"""
        url = f"https://{self.host}/api/v2/markets/news"
        params = {"ticker": ticker, "type": "ALL"}
        headers = {
            "x-rapidapi-key": self.api_key,
            "x-rapidapi-host": self.host
        }
        response = requests.get(url, params=params, headers=headers)
        return self._parse_articles(response.json())
    
    def get_recent_news(self, ticker: str, hours: int = 4) -> List[NewsArticle]:
        """Get news from last N hours"""
        all_news = self.fetch_news(ticker)
        return [n for n in all_news if self._is_recent(n.ago, hours)]
```

**Phase 2: News Analyzer (3 hours)**
```python
# core/intelligence/news_analyzer.py

class NewsAnalyzer:
    def __init__(self):
        self.news_client = RapidAPINewsClient()
        self.llm = GeminiClient()  # or Diffbot
        
    def analyze_market_narrative(self, ticker: str) -> NarrativeContext:
        """Extract narrative from recent news"""
        news = self.news_client.get_recent_news(ticker, hours=4)
        
        # Group by source credibility
        credible_news = [n for n in news if n.source in CREDIBLE_SOURCES]
        
        # Create prompt for LLM
        prompt = f"""
        Analyze these {len(credible_news)} headlines about {ticker}:
        
        {self._format_headlines(credible_news)}
        
        Extract:
        1. Overall sentiment (BULLISH/BEARISH/NEUTRAL)
        2. Key themes (3-5 bullet points)
        3. Potential catalysts
        4. Risk factors mentioned
        5. Institutional positioning hints
        
        Format as JSON.
        """
        
        analysis = self.llm.generate(prompt)
        return NarrativeContext(
            ticker=ticker,
            sentiment=analysis['sentiment'],
            themes=analysis['themes'],
            catalysts=analysis['catalysts'],
            risks=analysis['risks']
        )
```

**Phase 3: Narrative Brain Enhancement (2 hours)**
```python
# Update live_monitoring/orchestrator/narrative_brain.py

class NarrativeBrain:
    def __init__(self):
        self.news_analyzer = NewsAnalyzer()
        self.memory = NarrativeMemory()
        
    def generate_contextual_alert(self, signal, dp_data) -> str:
        """Generate alert with news context"""
        
        # Get recent news narrative
        narrative = self.news_analyzer.analyze_market_narrative(signal.symbol)
        
        # Check for divergence
        divergence = self._detect_divergence(signal, narrative)
        
        # Build contextual alert
        alert = f"""
ğŸ§  **CONTEXTUAL MARKET ALERT**

ğŸ“Š **Signal:** {signal.signal_type} on {signal.symbol}
ğŸ’° **Action:** {signal.action} @ ${signal.entry:.2f}

ğŸ“° **News Narrative:**
{self._format_themes(narrative.themes)}

ğŸ¯ **Catalysts:** {', '.join(narrative.catalysts)}
âš ï¸ **Risks:** {', '.join(narrative.risks)}

{'ğŸ”„ **DIVERGENCE DETECTED:** ' + divergence if divergence else ''}

ğŸ“š **Historical Context:**
{self.memory.get_relevant_context(signal.symbol)}
        """
        
        return alert
```

---

## ğŸ“… IMPLEMENTATION TIMELINE

### Week 1: Foundation
| Day | Task | Hours |
|-----|------|-------|
| 1 | Create `RapidAPINewsClient` | 2 |
| 1 | Test all endpoints, document responses | 2 |
| 2 | Create `NewsAnalyzer` with LLM integration | 3 |
| 2 | Build credibility scoring | 1 |
| 3 | Integrate with Narrative Brain | 2 |
| 3 | Add news context to Discord alerts | 2 |

### Week 2: Enhancement
| Day | Task | Hours |
|-----|------|-------|
| 4 | Add Diffbot for article summarization | 3 |
| 4 | Build divergence detection | 2 |
| 5 | Add real-time quote integration | 2 |
| 5 | Technical indicators integration | 2 |
| 6 | Full system testing | 3 |

---

## ğŸ¯ SUCCESS METRICS

1. **News Freshness:** Alert within 30 min of major news
2. **Context Quality:** Users understand "why" in every alert
3. **Divergence Detection:** Catch signal/narrative mismatches
4. **Reduced Noise:** Only alert on material narratives

---

## ğŸ“ FILES TO CREATE

```
core/data/
â”œâ”€â”€ rapidapi_news_client.py      # News fetcher
â”œâ”€â”€ rapidapi_quotes_client.py    # Quote fetcher
â””â”€â”€ rapidapi_indicators.py       # Technical indicators

core/intelligence/
â”œâ”€â”€ news_analyzer.py             # LLM-powered analysis
â”œâ”€â”€ narrative_context.py         # Context dataclass
â””â”€â”€ divergence_detector.py       # Signal vs narrative

live_monitoring/orchestrator/
â”œâ”€â”€ enhanced_narrative_brain.py  # Updated brain
```

---

## ğŸ”— RELATED DOCS

- [Narrative Brain Integration](mdc:NARRATIVE_BRAIN_INTEGRATION_COMPLETE.md)
- [Signal Generation Standards](mdc:.cursor/rules/signal-generation-standards.mdc)
- [ZETA Master Plan](mdc:.cursor/rules/ZETA_MASTER_PLAN.mdc)

---

## ğŸš€ IMMEDIATE NEXT STEPS

1. â³ Add `YAHOO_RAPIDAPI_KEY` to `.env`
2. â³ Create `rapidapi_news_client.py`
3. â³ Test news fetching in production
4. â³ Integrate with Narrative Brain
5. â³ Deploy enhanced alerts

---

**ALPHA'S MANTRA:** 
*"News is noise until we extract the signal. The API gives us the noise. The Narrative Brain gives us the edge."* ğŸ“°ğŸ§ ğŸ’°
